<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create saemix models from mmkin row objects — saemix_model • mkin</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Create saemix models from mmkin row objects — saemix_model" />
<meta property="og:description" content="This function sets up a nonlinear mixed effects model for an mmkin row
object for use with the saemix package. An mmkin row object is essentially a
list of mkinfit objects that have been obtained by fitting the same model to
a list of datasets." />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mkin</a>
        <span class="version label label-info" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.9.50.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Functions and data</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/mkin.html">Introduction to mkin</a>
    </li>
    <li>
      <a href="../articles/FOCUS_D.html">Example evaluation of FOCUS Example Dataset D</a>
    </li>
    <li>
      <a href="../articles/FOCUS_L.html">Example evaluation of FOCUS Laboratory Data L1 to L3</a>
    </li>
    <li>
      <a href="../articles/web_only/FOCUS_Z.html">Example evaluation of FOCUS Example Dataset Z</a>
    </li>
    <li>
      <a href="../articles/web_only/compiled_models.html">Performance benefit by using compiled model definitions in mkin</a>
    </li>
    <li>
      <a href="../articles/twa.html">Calculation of time weighted average concentrations with mkin</a>
    </li>
    <li>
      <a href="../articles/web_only/NAFTA_examples.html">Example evaluation of NAFTA SOP Attachment examples</a>
    </li>
    <li>
      <a href="../articles/web_only/benchmarks.html">Some benchmark timings</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jranke/mkin/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create saemix models from mmkin row objects</h1>
    <small class="dont-index">Source: <a href='https://github.com/jranke/mkin/blob/master/R/saemix.R'><code>R/saemix.R</code></a></small>
    <div class="hidden name"><code>saemix.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function sets up a nonlinear mixed effects model for an mmkin row
object for use with the saemix package. An mmkin row object is essentially a
list of mkinfit objects that have been obtained by fitting the same model to
a list of datasets.</p>
    </div>

    <pre class="usage"><span class='fu'>saemix_model</span><span class='op'>(</span><span class='va'>object</span>, cores <span class='op'>=</span> <span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/detectCores.html'>detectCores</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>saemix_data</span><span class='op'>(</span><span class='va'>object</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>An mmkin row object containing several fits of the same model to different datasets</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>The number of cores to be used for multicore processing.
On Windows machines, cores &gt; 1 is currently not supported.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further parameters passed to <a href='https://rdrr.io/pkg/saemix/man/saemixData.html'>saemix::saemixData</a></p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An <a href='https://rdrr.io/pkg/saemix/man/SaemixModel-class.html'>saemix::SaemixModel</a> object.</p>
<p>An <a href='https://rdrr.io/pkg/saemix/man/SaemixData-class.html'>saemix::SaemixData</a> object.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Starting values for the fixed effects (population mean parameters, argument psi0 of
<code><a href='https://rdrr.io/pkg/saemix/man/saemixModel.html'>saemix::saemixModel()</a></code> are the mean values of the parameters found using
mmkin. Starting variances of the random effects (argument omega.init) are the
variances of the deviations of the parameters from these mean values.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>ds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>experimental_data_for_UBA_2019</span><span class='op'>[</span><span class='fl'>6</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>]</span>,
 <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>$</span><span class='va'>data</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"name"</span>, <span class='st'>"time"</span>, <span class='st'>"value"</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>ds</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"Dataset"</span>, <span class='fl'>6</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>)</span>
<span class='va'>sfo_sfo</span> <span class='op'>&lt;-</span> <span class='fu'><a href='mkinmod.html'>mkinmod</a></span><span class='op'>(</span>parent <span class='op'>=</span> <span class='fu'><a href='mkinsub.html'>mkinsub</a></span><span class='op'>(</span><span class='st'>"SFO"</span>, <span class='st'>"A1"</span><span class='op'>)</span>,
  A1 <span class='op'>=</span> <span class='fu'><a href='mkinsub.html'>mkinsub</a></span><span class='op'>(</span><span class='st'>"SFO"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Successfully compiled differential equation model from auto-generated C code.</span></div><div class='input'><span class='co'># \dontrun{</span>
<span class='va'>f_mmkin</span> <span class='op'>&lt;-</span> <span class='fu'><a href='mmkin.html'>mmkin</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='st'>"SFO-SFO"</span> <span class='op'>=</span> <span class='va'>sfo_sfo</span><span class='op'>)</span>, <span class='va'>ds</span>, quiet <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>saemix</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Package saemix, version 3.1.9000</span>
#&gt; <span class='message'>  please direct bugs, questions and feedback to emmanuelle.comets@inserm.fr</span></div><div class='input'><span class='va'>m_saemix</span> <span class='op'>&lt;-</span> <span class='fu'>saemix_model</span><span class='op'>(</span><span class='va'>f_mmkin</span>, cores <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt; 
#&gt; The following SaemixModel object was successfully created:
#&gt; 
#&gt; Nonlinear mixed-effects model
#&gt;   Model function:  Mixed model generated from mmkin object  Model type:  structural
#&gt; function (psi, id, xidep) 
#&gt; {
#&gt;     uid &lt;- unique(id)
#&gt;     res_list &lt;- parallel::mclapply(uid, function(i) {
#&gt;         transparms_optim &lt;- psi[i, ]
#&gt;         names(transparms_optim) &lt;- names(degparms_optim)
#&gt;         odeini_optim &lt;- transparms_optim[odeini_optim_parm_names]
#&gt;         names(odeini_optim) &lt;- gsub("_0$", "", odeini_optim_parm_names)
#&gt;         odeini &lt;- c(odeini_optim, odeini_fixed)[names(mkin_model$diffs)]
#&gt;         ode_transparms_optim_names &lt;- setdiff(names(transparms_optim), 
#&gt;             odeini_optim_parm_names)
#&gt;         odeparms_optim &lt;- backtransform_odeparms(transparms_optim[ode_transparms_optim_names], 
#&gt;             mkin_model, transform_rates = object[[1]]$transform_rates, 
#&gt;             transform_fractions = object[[1]]$transform_fractions)
#&gt;         odeparms &lt;- c(odeparms_optim, odeparms_fixed)
#&gt;         xidep_i &lt;- subset(xidep, id == i)
#&gt;         if (analytical) {
#&gt;             out_values &lt;- mkin_model$deg_func(xidep_i, odeini, 
#&gt;                 odeparms)
#&gt;         }
#&gt;         else {
#&gt;             i_time &lt;- xidep_i$time
#&gt;             i_name &lt;- xidep_i$name
#&gt;             out_wide &lt;- mkinpredict(mkin_model, odeparms = odeparms, 
#&gt;                 odeini = odeini, solution_type = object[[1]]$solution_type, 
#&gt;                 outtimes = sort(unique(i_time)))
#&gt;             out_index &lt;- cbind(as.character(i_time), as.character(i_name))
#&gt;             out_values &lt;- out_wide[out_index]
#&gt;         }
#&gt;         return(out_values)
#&gt;     }, mc.cores = cores)
#&gt;     res &lt;- unlist(res_list)
#&gt;     return(res)
#&gt; }
#&gt; &lt;bytecode: 0x55555c1e7720&gt;
#&gt; &lt;environment: 0x55555c1eff38&gt;
#&gt;   Nb of parameters: 4 
#&gt;       parameter names:  parent_0 log_k_parent log_k_A1 f_parent_ilr_1 
#&gt;       distribution:
#&gt;      Parameter      Distribution Estimated
#&gt; [1,] parent_0       normal       Estimated
#&gt; [2,] log_k_parent   normal       Estimated
#&gt; [3,] log_k_A1       normal       Estimated
#&gt; [4,] f_parent_ilr_1 normal       Estimated
#&gt;   Variance-covariance matrix:
#&gt;                parent_0 log_k_parent log_k_A1 f_parent_ilr_1
#&gt; parent_0              1            0        0              0
#&gt; log_k_parent          0            1        0              0
#&gt; log_k_A1              0            0        1              0
#&gt; f_parent_ilr_1        0            0        0              1
#&gt;   Error model: constant , initial values: a.1=4.97259024646577 
#&gt;     No covariate in the model.
#&gt;     Initial values
#&gt;              parent_0 log_k_parent  log_k_A1 f_parent_ilr_1
#&gt; Pop.CondInit 86.53449    -3.207005 -3.060308      -1.920449</div><div class='input'><span class='va'>d_saemix</span> <span class='op'>&lt;-</span> <span class='fu'>saemix_data</span><span class='op'>(</span><span class='va'>f_mmkin</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt; 
#&gt; The following SaemixData object was successfully created:
#&gt; 
#&gt; Object of class SaemixData
#&gt;     longitudinal data for use with the SAEM algorithm
#&gt; Dataset ds_saemix 
#&gt;     Structured data: value ~ time + name | ds 
#&gt;     X variable for graphs: time () </div><div class='input'><span class='va'>saemix_options</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>seed <span class='op'>=</span> <span class='fl'>123456</span>,
  save <span class='op'>=</span> <span class='cn'>FALSE</span>, save.graphs <span class='op'>=</span> <span class='cn'>FALSE</span>, displayProgress <span class='op'>=</span> <span class='cn'>FALSE</span>,
  nbiter.saemix <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>200</span>, <span class='fl'>80</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>f_saemix</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/saemix/man/saemix.html'>saemix</a></span><span class='op'>(</span><span class='va'>m_saemix</span>, <span class='va'>d_saemix</span>, <span class='va'>saemix_options</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Running main SAEM algorithm
#&gt; [1] "Thu Oct 15 11:55:14 2020"
#&gt; ..
#&gt;     Minimisation finished
#&gt; [1] "Thu Oct 15 11:57:07 2020"</div><div class='img'><img src='saemix-1.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; Nonlinear mixed-effects model fit by the SAEM algorithm
#&gt; -----------------------------------
#&gt; ----          Data             ----
#&gt; -----------------------------------
#&gt; Object of class SaemixData
#&gt;     longitudinal data for use with the SAEM algorithm
#&gt; Dataset ds_saemix 
#&gt;     Structured data: value ~ time + name | ds 
#&gt;     X variable for graphs: time () 
#&gt; Dataset characteristics:
#&gt;     number of subjects:     5 
#&gt;     number of observations: 170 
#&gt;     average/min/max nb obs: 34.00  /  30  /  38 
#&gt; First 10 lines of data:
#&gt;           ds time   name value mdv cens occ ytype
#&gt; 1  Dataset 6    0 parent  97.2   0    0   1     1
#&gt; 2  Dataset 6    0 parent  96.4   0    0   1     1
#&gt; 3  Dataset 6    3 parent  71.1   0    0   1     1
#&gt; 4  Dataset 6    3 parent  69.2   0    0   1     1
#&gt; 5  Dataset 6    6 parent  58.1   0    0   1     1
#&gt; 6  Dataset 6    6 parent  56.6   0    0   1     1
#&gt; 7  Dataset 6   10 parent  44.4   0    0   1     1
#&gt; 8  Dataset 6   10 parent  43.4   0    0   1     1
#&gt; 9  Dataset 6   20 parent  33.3   0    0   1     1
#&gt; 10 Dataset 6   20 parent  29.2   0    0   1     1
#&gt; -----------------------------------
#&gt; ----          Model            ----
#&gt; -----------------------------------
#&gt; Nonlinear mixed-effects model
#&gt;   Model function:  Mixed model generated from mmkin object  Model type:  structural
#&gt; function (psi, id, xidep) 
#&gt; {
#&gt;     uid &lt;- unique(id)
#&gt;     res_list &lt;- parallel::mclapply(uid, function(i) {
#&gt;         transparms_optim &lt;- psi[i, ]
#&gt;         names(transparms_optim) &lt;- names(degparms_optim)
#&gt;         odeini_optim &lt;- transparms_optim[odeini_optim_parm_names]
#&gt;         names(odeini_optim) &lt;- gsub("_0$", "", odeini_optim_parm_names)
#&gt;         odeini &lt;- c(odeini_optim, odeini_fixed)[names(mkin_model$diffs)]
#&gt;         ode_transparms_optim_names &lt;- setdiff(names(transparms_optim), 
#&gt;             odeini_optim_parm_names)
#&gt;         odeparms_optim &lt;- backtransform_odeparms(transparms_optim[ode_transparms_optim_names], 
#&gt;             mkin_model, transform_rates = object[[1]]$transform_rates, 
#&gt;             transform_fractions = object[[1]]$transform_fractions)
#&gt;         odeparms &lt;- c(odeparms_optim, odeparms_fixed)
#&gt;         xidep_i &lt;- subset(xidep, id == i)
#&gt;         if (analytical) {
#&gt;             out_values &lt;- mkin_model$deg_func(xidep_i, odeini, 
#&gt;                 odeparms)
#&gt;         }
#&gt;         else {
#&gt;             i_time &lt;- xidep_i$time
#&gt;             i_name &lt;- xidep_i$name
#&gt;             out_wide &lt;- mkinpredict(mkin_model, odeparms = odeparms, 
#&gt;                 odeini = odeini, solution_type = object[[1]]$solution_type, 
#&gt;                 outtimes = sort(unique(i_time)))
#&gt;             out_index &lt;- cbind(as.character(i_time), as.character(i_name))
#&gt;             out_values &lt;- out_wide[out_index]
#&gt;         }
#&gt;         return(out_values)
#&gt;     }, mc.cores = cores)
#&gt;     res &lt;- unlist(res_list)
#&gt;     return(res)
#&gt; }
#&gt; &lt;bytecode: 0x55555c1e7720&gt;
#&gt; &lt;environment: 0x55555c1eff38&gt;
#&gt;   Nb of parameters: 4 
#&gt;       parameter names:  parent_0 log_k_parent log_k_A1 f_parent_ilr_1 
#&gt;       distribution:
#&gt;      Parameter      Distribution Estimated
#&gt; [1,] parent_0       normal       Estimated
#&gt; [2,] log_k_parent   normal       Estimated
#&gt; [3,] log_k_A1       normal       Estimated
#&gt; [4,] f_parent_ilr_1 normal       Estimated
#&gt;   Variance-covariance matrix:
#&gt;                parent_0 log_k_parent log_k_A1 f_parent_ilr_1
#&gt; parent_0              1            0        0              0
#&gt; log_k_parent          0            1        0              0
#&gt; log_k_A1              0            0        1              0
#&gt; f_parent_ilr_1        0            0        0              1
#&gt;   Error model: constant , initial values: a.1=4.97259024646577 
#&gt;     No covariate in the model.
#&gt;     Initial values
#&gt;              parent_0 log_k_parent  log_k_A1 f_parent_ilr_1
#&gt; Pop.CondInit 86.53449    -3.207005 -3.060308      -1.920449
#&gt; -----------------------------------
#&gt; ----    Key algorithm options  ----
#&gt; -----------------------------------
#&gt;     Estimation of individual parameters (MAP)
#&gt;     Estimation of standard errors and linearised log-likelihood
#&gt;     Estimation of log-likelihood by importance sampling
#&gt;     Number of iterations:  K1=200, K2=80 
#&gt;     Number of chains:  10 
#&gt;     Seed:  123456 
#&gt;     Number of MCMC iterations for IS:  5000 
#&gt;     Simulations:
#&gt;         nb of simulated datasets used for npde:  1000 
#&gt;         nb of simulated datasets used for VPC:  100 
#&gt;     Input/output
#&gt;         save the results to a file:  FALSE 
#&gt;         save the graphs to files:  FALSE 
#&gt; ----------------------------------------------------
#&gt; ----                  Results                   ----
#&gt; ----------------------------------------------------
#&gt; -----------------  Fixed effects  ------------------
#&gt; ----------------------------------------------------
#&gt;   Parameter      Estimate SE   CV(%)
#&gt;   parent_0       86.09    1.57  1.8 
#&gt;   log_k_parent   -3.21    0.59 18.5 
#&gt;   log_k_A1       -4.69    0.31  6.6 
#&gt;   f_parent_ilr_1 -0.34    0.30 89.2 
#&gt; a a.1             4.69    0.27  5.8 
#&gt; ----------------------------------------------------
#&gt; -----------  Variance of random effects  -----------
#&gt; ----------------------------------------------------
#&gt;                Parameter             Estimate SE   CV(%)
#&gt; parent_0       omega2.parent_0       7.07     7.72 109  
#&gt; log_k_parent   omega2.log_k_parent   1.75     1.11  63  
#&gt; log_k_A1       omega2.log_k_A1       0.28     0.28  99  
#&gt; f_parent_ilr_1 omega2.f_parent_ilr_1 0.39     0.27  71  
#&gt; ----------------------------------------------------
#&gt; ------  Correlation matrix of random effects  ------
#&gt; ----------------------------------------------------
#&gt;                       omega2.parent_0 omega2.log_k_parent omega2.log_k_A1
#&gt; omega2.parent_0       1               0                   0              
#&gt; omega2.log_k_parent   0               1                   0              
#&gt; omega2.log_k_A1       0               0                   1              
#&gt; omega2.f_parent_ilr_1 0               0                   0              
#&gt;                       omega2.f_parent_ilr_1
#&gt; omega2.parent_0       0                    
#&gt; omega2.log_k_parent   0                    
#&gt; omega2.log_k_A1       0                    
#&gt; omega2.f_parent_ilr_1 1                    
#&gt; ----------------------------------------------------
#&gt; ---------------  Statistical criteria  -------------
#&gt; ----------------------------------------------------
#&gt; Likelihood computed by linearisation
#&gt;       -2LL= 1064.35 
#&gt;       AIC = 1082.35 
#&gt;       BIC = 1078.835 
#&gt; 
#&gt; Likelihood computed by importance sampling
#&gt;       -2LL= 1063.475 
#&gt;       AIC = 1081.475 
#&gt;       BIC = 1077.96 
#&gt; ----------------------------------------------------</div><div class='input'><span class='fu'><a href='https://rdrr.io/pkg/saemix/man/plot-SaemixObject-method.html'>plot</a></span><span class='op'>(</span><span class='va'>f_saemix</span>, plot.type <span class='op'>=</span> <span class='st'>"convergence"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Plotting convergence plots</div><div class='img'><img src='saemix-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>
<span class='co'># Synthetic data with two-component error</span>
<span class='va'>sampling_times</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>3</span>, <span class='fl'>7</span>, <span class='fl'>14</span>, <span class='fl'>28</span>, <span class='fl'>60</span>, <span class='fl'>90</span>, <span class='fl'>120</span><span class='op'>)</span>
<span class='va'>dt50_sfo_in</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>800</span>, <span class='fl'>900</span>, <span class='fl'>1000</span>, <span class='fl'>1111.11</span>, <span class='fl'>1250</span><span class='op'>)</span>
<span class='va'>k_in</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>dt50_sfo_in</span>

<span class='va'>SFO</span> <span class='op'>&lt;-</span> <span class='fu'><a href='mkinmod.html'>mkinmod</a></span><span class='op'>(</span>parent <span class='op'>=</span> <span class='fu'><a href='mkinsub.html'>mkinsub</a></span><span class='op'>(</span><span class='st'>"SFO"</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>pred_sfo</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>k</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='mkinpredict.html'>mkinpredict</a></span><span class='op'>(</span><span class='va'>SFO</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>k_parent <span class='op'>=</span> <span class='va'>k</span><span class='op'>)</span>,
    <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>parent <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>, <span class='va'>sampling_times</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>ds_sfo_mean</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>k_in</span>, <span class='va'>pred_sfo</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123456L</span><span class='op'>)</span>
<span class='va'>ds_sfo_syn</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>ds_sfo_mean</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>ds</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='add_err.html'>add_err</a></span><span class='op'>(</span><span class='va'>ds</span>, sdfunc <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>value</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>*</span> <span class='fl'>0.07</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>,
     n <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
 <span class='op'>}</span><span class='op'>)</span>
<span class='va'>f_mmkin_syn</span> <span class='op'>&lt;-</span> <span class='fu'><a href='mmkin.html'>mmkin</a></span><span class='op'>(</span><span class='st'>"SFO"</span>, <span class='va'>ds_sfo_syn</span>, error_model <span class='op'>=</span> <span class='st'>"tc"</span>, quiet <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>m_saemix_tc</span> <span class='op'>&lt;-</span> <span class='fu'>saemix_model</span><span class='op'>(</span><span class='va'>f_mmkin_syn</span>, cores <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt; 
#&gt; The following SaemixModel object was successfully created:
#&gt; 
#&gt; Nonlinear mixed-effects model
#&gt;   Model function:  Mixed model generated from mmkin object  Model type:  structural
#&gt; function (psi, id, xidep) 
#&gt; {
#&gt;     uid &lt;- unique(id)
#&gt;     res_list &lt;- parallel::mclapply(uid, function(i) {
#&gt;         transparms_optim &lt;- psi[i, ]
#&gt;         names(transparms_optim) &lt;- names(degparms_optim)
#&gt;         odeini_optim &lt;- transparms_optim[odeini_optim_parm_names]
#&gt;         names(odeini_optim) &lt;- gsub("_0$", "", odeini_optim_parm_names)
#&gt;         odeini &lt;- c(odeini_optim, odeini_fixed)[names(mkin_model$diffs)]
#&gt;         ode_transparms_optim_names &lt;- setdiff(names(transparms_optim), 
#&gt;             odeini_optim_parm_names)
#&gt;         odeparms_optim &lt;- backtransform_odeparms(transparms_optim[ode_transparms_optim_names], 
#&gt;             mkin_model, transform_rates = object[[1]]$transform_rates, 
#&gt;             transform_fractions = object[[1]]$transform_fractions)
#&gt;         odeparms &lt;- c(odeparms_optim, odeparms_fixed)
#&gt;         xidep_i &lt;- subset(xidep, id == i)
#&gt;         if (analytical) {
#&gt;             out_values &lt;- mkin_model$deg_func(xidep_i, odeini, 
#&gt;                 odeparms)
#&gt;         }
#&gt;         else {
#&gt;             i_time &lt;- xidep_i$time
#&gt;             i_name &lt;- xidep_i$name
#&gt;             out_wide &lt;- mkinpredict(mkin_model, odeparms = odeparms, 
#&gt;                 odeini = odeini, solution_type = object[[1]]$solution_type, 
#&gt;                 outtimes = sort(unique(i_time)))
#&gt;             out_index &lt;- cbind(as.character(i_time), as.character(i_name))
#&gt;             out_values &lt;- out_wide[out_index]
#&gt;         }
#&gt;         return(out_values)
#&gt;     }, mc.cores = cores)
#&gt;     res &lt;- unlist(res_list)
#&gt;     return(res)
#&gt; }
#&gt; &lt;bytecode: 0x55555c1e7720&gt;
#&gt; &lt;environment: 0x55555be5b848&gt;
#&gt;   Nb of parameters: 2 
#&gt;       parameter names:  parent_0 log_k_parent 
#&gt;       distribution:
#&gt;      Parameter    Distribution Estimated
#&gt; [1,] parent_0     normal       Estimated
#&gt; [2,] log_k_parent normal       Estimated
#&gt;   Variance-covariance matrix:
#&gt;              parent_0 log_k_parent
#&gt; parent_0            1            0
#&gt; log_k_parent        0            1
#&gt;   Error model: combined , initial values: a.1=2.4206146215511 b.1=0.03831266409084 
#&gt;     No covariate in the model.
#&gt;     Initial values
#&gt;              parent_0 log_k_parent
#&gt; Pop.CondInit 100.2498     -9.33922</div><div class='input'><span class='va'>d_saemix_tc</span> <span class='op'>&lt;-</span> <span class='fu'>saemix_data</span><span class='op'>(</span><span class='va'>f_mmkin_syn</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt; 
#&gt; The following SaemixData object was successfully created:
#&gt; 
#&gt; Object of class SaemixData
#&gt;     longitudinal data for use with the SAEM algorithm
#&gt; Dataset ds_saemix 
#&gt;     Structured data: value ~ time + name | ds 
#&gt;     X variable for graphs: time () </div><div class='input'><span class='va'>f_saemix_tc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/saemix/man/saemix.html'>saemix</a></span><span class='op'>(</span><span class='va'>m_saemix_tc</span>, <span class='va'>d_saemix_tc</span>, <span class='va'>saemix_options</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Running main SAEM algorithm
#&gt; [1] "Thu Oct 15 11:57:25 2020"
#&gt; ..
#&gt;     Minimisation finished
#&gt; [1] "Thu Oct 15 11:58:16 2020"
#&gt; Error in solve.default(Fth) : 
#&gt;   Lapack routine dgesv: system is exactly singular: U[2,2] = 0
#&gt; Error computing the Fisher Information Matrix: singular system.
#&gt; Error in solve.default(FO) : 
#&gt;   Lapack routine dgesv: system is exactly singular: U[2,2] = 0
#&gt; Error computing the Fisher Information Matrix: singular system.</div><div class='output co'>#&gt; Nonlinear mixed-effects model fit by the SAEM algorithm
#&gt; -----------------------------------
#&gt; ----          Data             ----
#&gt; -----------------------------------
#&gt; Object of class SaemixData
#&gt;     longitudinal data for use with the SAEM algorithm
#&gt; Dataset ds_saemix 
#&gt;     Structured data: value ~ time + name | ds 
#&gt;     X variable for graphs: time () 
#&gt; Dataset characteristics:
#&gt;     number of subjects:     5 
#&gt;     number of observations: 90 
#&gt;     average/min/max nb obs: 18.00  /  18  /  18 
#&gt; First 10 lines of data:
#&gt;    ds time   name value mdv cens occ ytype
#&gt; 1   1    0 parent 105.9   0    0   1     1
#&gt; 2   1    0 parent  98.0   0    0   1     1
#&gt; 3   1    1 parent  97.4   0    0   1     1
#&gt; 4   1    1 parent 100.5   0    0   1     1
#&gt; 5   1    3 parent 115.6   0    0   1     1
#&gt; 6   1    3 parent 105.6   0    0   1     1
#&gt; 7   1    7 parent 108.6   0    0   1     1
#&gt; 8   1    7 parent 117.0   0    0   1     1
#&gt; 9   1   14 parent 107.0   0    0   1     1
#&gt; 10  1   14 parent  95.8   0    0   1     1
#&gt; -----------------------------------
#&gt; ----          Model            ----
#&gt; -----------------------------------
#&gt; Nonlinear mixed-effects model
#&gt;   Model function:  Mixed model generated from mmkin object  Model type:  structural
#&gt; function (psi, id, xidep) 
#&gt; {
#&gt;     uid &lt;- unique(id)
#&gt;     res_list &lt;- parallel::mclapply(uid, function(i) {
#&gt;         transparms_optim &lt;- psi[i, ]
#&gt;         names(transparms_optim) &lt;- names(degparms_optim)
#&gt;         odeini_optim &lt;- transparms_optim[odeini_optim_parm_names]
#&gt;         names(odeini_optim) &lt;- gsub("_0$", "", odeini_optim_parm_names)
#&gt;         odeini &lt;- c(odeini_optim, odeini_fixed)[names(mkin_model$diffs)]
#&gt;         ode_transparms_optim_names &lt;- setdiff(names(transparms_optim), 
#&gt;             odeini_optim_parm_names)
#&gt;         odeparms_optim &lt;- backtransform_odeparms(transparms_optim[ode_transparms_optim_names], 
#&gt;             mkin_model, transform_rates = object[[1]]$transform_rates, 
#&gt;             transform_fractions = object[[1]]$transform_fractions)
#&gt;         odeparms &lt;- c(odeparms_optim, odeparms_fixed)
#&gt;         xidep_i &lt;- subset(xidep, id == i)
#&gt;         if (analytical) {
#&gt;             out_values &lt;- mkin_model$deg_func(xidep_i, odeini, 
#&gt;                 odeparms)
#&gt;         }
#&gt;         else {
#&gt;             i_time &lt;- xidep_i$time
#&gt;             i_name &lt;- xidep_i$name
#&gt;             out_wide &lt;- mkinpredict(mkin_model, odeparms = odeparms, 
#&gt;                 odeini = odeini, solution_type = object[[1]]$solution_type, 
#&gt;                 outtimes = sort(unique(i_time)))
#&gt;             out_index &lt;- cbind(as.character(i_time), as.character(i_name))
#&gt;             out_values &lt;- out_wide[out_index]
#&gt;         }
#&gt;         return(out_values)
#&gt;     }, mc.cores = cores)
#&gt;     res &lt;- unlist(res_list)
#&gt;     return(res)
#&gt; }
#&gt; &lt;bytecode: 0x55555c1e7720&gt;
#&gt; &lt;environment: 0x55555be5b848&gt;
#&gt;   Nb of parameters: 2 
#&gt;       parameter names:  parent_0 log_k_parent 
#&gt;       distribution:
#&gt;      Parameter    Distribution Estimated
#&gt; [1,] parent_0     normal       Estimated
#&gt; [2,] log_k_parent normal       Estimated
#&gt;   Variance-covariance matrix:
#&gt;              parent_0 log_k_parent
#&gt; parent_0            1            0
#&gt; log_k_parent        0            1
#&gt;   Error model: combined , initial values: a.1=2.4206146215511 b.1=0.03831266409084 
#&gt;     No covariate in the model.
#&gt;     Initial values
#&gt;              parent_0 log_k_parent
#&gt; Pop.CondInit 100.2498     -9.33922
#&gt; -----------------------------------
#&gt; ----    Key algorithm options  ----
#&gt; -----------------------------------
#&gt;     Estimation of individual parameters (MAP)
#&gt;     Estimation of standard errors and linearised log-likelihood
#&gt;     Estimation of log-likelihood by importance sampling
#&gt;     Number of iterations:  K1=200, K2=80 
#&gt;     Number of chains:  10 
#&gt;     Seed:  123456 
#&gt;     Number of MCMC iterations for IS:  5000 
#&gt;     Simulations:
#&gt;         nb of simulated datasets used for npde:  1000 
#&gt;         nb of simulated datasets used for VPC:  100 
#&gt;     Input/output
#&gt;         save the results to a file:  FALSE 
#&gt;         save the graphs to files:  FALSE 
#&gt; ----------------------------------------------------
#&gt; ----                  Results                   ----
#&gt; ----------------------------------------------------
#&gt; -----------------  Fixed effects  ------------------
#&gt; ----------------------------------------------------
#&gt;   Parameter    Estimate SE   CV(%)
#&gt;   parent_0      97.44   &lt;NA&gt; &lt;NA&gt; 
#&gt;   log_k_parent -56.97   &lt;NA&gt; &lt;NA&gt; 
#&gt; a a.1           -7.12   &lt;NA&gt; &lt;NA&gt; 
#&gt; b b.1            0.15   &lt;NA&gt; &lt;NA&gt; 
#&gt; ----------------------------------------------------
#&gt; -----------  Variance of random effects  -----------
#&gt; ----------------------------------------------------
#&gt;              Parameter           Estimate SE CV(%)
#&gt; parent_0     omega2.parent_0       2.8    NA NA   
#&gt; log_k_parent omega2.log_k_parent 750.3    NA NA   
#&gt; ----------------------------------------------------
#&gt; ------  Correlation matrix of random effects  ------
#&gt; ----------------------------------------------------
#&gt;                     omega2.parent_0 omega2.log_k_parent
#&gt; omega2.parent_0     1               0                  
#&gt; omega2.log_k_parent 0               1                  
#&gt; ----------------------------------------------------
#&gt; ---------------  Statistical criteria  -------------
#&gt; ----------------------------------------------------
#&gt; Likelihood computed by linearisation
#&gt;       -2LL= 623.7744 
#&gt;       AIC = 635.7744 
#&gt;       BIC = 633.431 
#&gt; 
#&gt; Likelihood computed by importance sampling
#&gt;       -2LL= 621.1909 
#&gt;       AIC = 633.1909 
#&gt;       BIC = 630.8475 
#&gt; ----------------------------------------------------</div><div class='input'><span class='fu'><a href='https://rdrr.io/pkg/saemix/man/plot-SaemixObject-method.html'>plot</a></span><span class='op'>(</span><span class='va'>f_saemix_tc</span>, plot.type <span class='op'>=</span> <span class='st'>"convergence"</span><span class='op'>)</span>
</div><div class='img'><img src='saemix-3.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; Plotting convergence plots</div><div class='img'><img src='saemix-4.png' alt='' width='700' height='433' /></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Johannes Ranke.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


