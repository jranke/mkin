<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create an nlme model for an mmkin row object — nlme.mmkin • mkin</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create an nlme model for an mmkin row object — nlme.mmkin"><meta name="description" content="This functions sets up a nonlinear mixed effects model for an mmkin row
object. An mmkin row object is essentially a list of mkinfit objects that
have been obtained by fitting the same model to a list of datasets."><meta property="og:description" content="This functions sets up a nonlinear mixed effects model for an mmkin row
object. An mmkin row object is essentially a list of mkinfit objects that
have been obtained by fitting the same model to a list of datasets."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mkin</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.10</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/mkin.html">Introduction to mkin</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Example evaluations with (generalised) nonlinear least squares</h6></li>
    <li><a class="dropdown-item" href="../articles/FOCUS_D.html">Example evaluation of FOCUS Example Dataset D</a></li>
    <li><a class="dropdown-item" href="../articles/FOCUS_L.html">Example evaluation of FOCUS Laboratory Data L1 to L3</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/FOCUS_Z.html">Example evaluation of FOCUS Example Dataset Z</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Example evaluations with hierarchical models (nonlinear mixed-effects models)</h6></li>
    <li><a class="dropdown-item" href="../articles/prebuilt/2022_dmta_parent.html">Testing hierarchical parent degradation kinetics with residue data on dimethenamid and dimethenamid-P</a></li>
    <li><a class="dropdown-item" href="../articles/prebuilt/2022_dmta_pathway.html">Testing hierarchical pathway kinetics with residue data on dimethenamid and dimethenamid-P</a></li>
    <li><a class="dropdown-item" href="../articles/prebuilt/2023_mesotrione_parent.html">Testing covariate modelling in hierarchical parent degradation kinetics with residue data on mesotrione</a></li>
    <li><a class="dropdown-item" href="../articles/prebuilt/2022_cyan_pathway.html">Testing hierarchical pathway kinetics with residue data on cyantraniliprole</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/dimethenamid_2018.html">Comparison of saemix and nlme evaluations of dimethenamid data from 2018</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/multistart.html">Short demo of the multistart method</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Performance</h6></li>
    <li><a class="dropdown-item" href="../articles/web_only/compiled_models.html">Performance benefit by using compiled model definitions in mkin</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/benchmarks.html">Benchmark timings for mkin</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/saem_benchmarks.html">Benchmark timings for saem.mmkin</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Miscellaneous</h6></li>
    <li><a class="dropdown-item" href="../articles/twa.html">Calculation of time weighted average concentrations with mkin</a></li>
    <li><a class="dropdown-item" href="../articles/web_only/NAFTA_examples.html">Example evaluation of NAFTA SOP Attachment examples</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../coverage/coverage.html">Test coverage</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jranke/mkin/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create an nlme model for an mmkin row object</h1>
      <small class="dont-index">Source: <a href="https://github.com/jranke/mkin/blob/HEAD/R/nlme.mmkin.R" class="external-link"><code>R/nlme.mmkin.R</code></a></small>
      <div class="d-none name"><code>nlme.mmkin.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This functions sets up a nonlinear mixed effects model for an mmkin row
object. An mmkin row object is essentially a list of mkinfit objects that
have been obtained by fitting the same model to a list of datasets.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'mmkin'</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/nlme.html" class="external-link">nlme</a></span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  data <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="mean_degparms.html">mean_degparms</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">el</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">parse</a></span><span class="op">(</span>text <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">el</span>, <span class="fl">1</span>, sep <span class="op">=</span> <span class="st">"~"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  random <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/pdDiag.html" class="external-link">pdDiag</a></span><span class="op">(</span><span class="va">fixed</span><span class="op">)</span>,</span>
<span>  <span class="va">groups</span>,</span>
<span>  start <span class="op">=</span> <span class="fu"><a href="mean_degparms.html">mean_degparms</a></span><span class="op">(</span><span class="va">model</span>, random <span class="op">=</span> <span class="cn">TRUE</span>, test_log_parms <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  correlation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">subset</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ML"</span>, <span class="st">"REML"</span><span class="op">)</span>,</span>
<span>  na.action <span class="op">=</span> <span class="va">na.fail</span>,</span>
<span>  <span class="va">naPattern</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'nlme.mmkin'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"digits"</span><span class="op">)</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'nlme.mmkin'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>An <a href="mmkin.html">mmkin</a> row object.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Ignored, data are taken from the mmkin model</p></dd>


<dt id="arg-fixed">fixed<a class="anchor" aria-label="anchor" href="#arg-fixed"></a></dt>
<dd><p>Ignored, all degradation parameters fitted in the
mmkin model are used as fixed parameters</p></dd>


<dt id="arg-random">random<a class="anchor" aria-label="anchor" href="#arg-random"></a></dt>
<dd><p>If not specified, no correlations between random effects are
set up for the optimised degradation model parameters. This is
achieved by using the <a href="https://rdrr.io/pkg/nlme/man/pdDiag.html" class="external-link">nlme::pdDiag</a> method.</p></dd>


<dt id="arg-groups">groups<a class="anchor" aria-label="anchor" href="#arg-groups"></a></dt>
<dd><p>See the documentation of nlme</p></dd>


<dt id="arg-start">start<a class="anchor" aria-label="anchor" href="#arg-start"></a></dt>
<dd><p>If not specified, mean values of the fitted degradation
parameters taken from the mmkin object are used</p></dd>


<dt id="arg-correlation">correlation<a class="anchor" aria-label="anchor" href="#arg-correlation"></a></dt>
<dd><p>See the documentation of nlme</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>passed to nlme</p></dd>


<dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>passed to nlme</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>passed to nlme</p></dd>


<dt id="arg-na-action">na.action<a class="anchor" aria-label="anchor" href="#arg-na-action"></a></dt>
<dd><p>passed to nlme</p></dd>


<dt id="arg-napattern">naPattern<a class="anchor" aria-label="anchor" href="#arg-napattern"></a></dt>
<dd><p>passed to nlme</p></dd>


<dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>passed to nlme</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>passed to nlme</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An nlme.mmkin object to print</p></dd>


<dt id="arg-digits">digits<a class="anchor" aria-label="anchor" href="#arg-digits"></a></dt>
<dd><p>Number of digits to use for printing</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Update specifications passed to update.nlme</p></dd>


<dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>An nlme.mmkin object to update</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Upon success, a fitted 'nlme.mmkin' object, which is an nlme object
with additional elements. It also inherits from 'mixed.mmkin'.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Note that the convergence of the nlme algorithms depends on the quality
of the data. In degradation kinetics, we often only have few datasets
(e.g. data for few soils) and complicated degradation models, which may
make it impossible to obtain convergence with nlme.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>As the object inherits from <a href="https://rdrr.io/pkg/nlme/man/nlme.html" class="external-link">nlme::nlme</a>, there is a wealth of
methods that will automatically work on 'nlme.mmkin' objects, such as
<code><a href="https://rdrr.io/pkg/nlme/man/intervals.html" class="external-link">nlme::intervals()</a></code>, <code><a href="https://rdrr.io/pkg/nlme/man/anova.lme.html" class="external-link">nlme::anova.lme()</a></code> and <code><a href="https://rdrr.io/pkg/nlme/man/coef.lme.html" class="external-link">nlme::coef.lme()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="nlme.html">nlme_function()</a></code>, <a href="plot.mixed.mmkin.html">plot.mixed.mmkin</a>, <a href="summary.nlme.mmkin.html">summary.nlme.mmkin</a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">experimental_data_for_UBA_2019</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span></span>
<span class="r-in"><span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"time"</span>, <span class="st">"value"</span><span class="op">)</span><span class="op">]</span>, <span class="va">name</span> <span class="op">==</span> <span class="st">"parent"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="mmkin.html">mmkin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SFO"</span>, <span class="st">"DFOP"</span><span class="op">)</span>, <span class="va">ds</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>, cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/" class="external-link">nlme</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">f_nlme_sfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/nlme.html" class="external-link">nlme</a></span><span class="op">(</span><span class="va">f</span><span class="op">[</span><span class="st">"SFO"</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">f_nlme_dfop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/nlme.html" class="external-link">nlme</a></span><span class="op">(</span><span class="va">f</span><span class="op">[</span><span class="st">"DFOP"</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">f_nlme_sfo</span>, <span class="va">f_nlme_dfop</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Model df      AIC      BIC    logLik   Test  L.Ratio p-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_nlme_sfo      1  5 625.0539 637.5529 -307.5269                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_nlme_dfop     2  9 495.1270 517.6253 -238.5635 1 vs 2 137.9269  &lt;.0001</span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">f_nlme_dfop</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kinetic nonlinear mixed-effects model fit by maximum likelihood</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Structural model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d_parent/dt = - ((k1 * g * exp(-k1 * time) + k2 * (1 - g) * exp(-k2 *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            time)) / (g * exp(-k1 * time) + (1 - g) * exp(-k2 * time)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            * parent</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 90 observations of 1 variable(s) grouped in 5 datasets</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: -238.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  list(parent_0 ~ 1, log_k1 ~ 1, log_k2 ~ 1, g_qlogis ~ 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> parent_0   log_k1   log_k2 g_qlogis </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  94.1702  -1.8002  -4.1474   0.0324 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Formula: list(parent_0 ~ 1, log_k1 ~ 1, log_k2 ~ 1, g_qlogis ~ 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Level: ds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Structure: Diagonal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         parent_0 log_k1 log_k2 g_qlogis Residual</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev:    2.488 0.8447   1.33   0.4652    2.321</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">f_nlme_dfop</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="nlme.mmkin-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span>  <span class="fu"><a href="endpoints.html">endpoints</a></span><span class="op">(</span><span class="va">f_nlme_dfop</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $distimes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            DT50     DT90 DT50back  DT50_k1  DT50_k2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> parent 10.79857 100.7937 30.34192 4.193937 43.85442</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">ds_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">experimental_data_for_UBA_2019</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>   <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"time"</span>, <span class="st">"value"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">m_sfo_sfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="mkinmod.html">mkinmod</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="fu"><a href="mkinmod.html">mkinsub</a></span><span class="op">(</span><span class="st">"SFO"</span>, <span class="st">"A1"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    A1 <span class="op">=</span> <span class="fu"><a href="mkinmod.html">mkinsub</a></span><span class="op">(</span><span class="st">"SFO"</span><span class="op">)</span>, use_of_ff <span class="op">=</span> <span class="st">"min"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">m_sfo_sfo_ff</span> <span class="op">&lt;-</span> <span class="fu"><a href="mkinmod.html">mkinmod</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="fu"><a href="mkinmod.html">mkinsub</a></span><span class="op">(</span><span class="st">"SFO"</span>, <span class="st">"A1"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    A1 <span class="op">=</span> <span class="fu"><a href="mkinmod.html">mkinsub</a></span><span class="op">(</span><span class="st">"SFO"</span><span class="op">)</span>, use_of_ff <span class="op">=</span> <span class="st">"max"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">m_dfop_sfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="mkinmod.html">mkinmod</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="fu"><a href="mkinmod.html">mkinsub</a></span><span class="op">(</span><span class="st">"DFOP"</span>, <span class="st">"A1"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    A1 <span class="op">=</span> <span class="fu"><a href="mkinmod.html">mkinsub</a></span><span class="op">(</span><span class="st">"SFO"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">f_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="mmkin.html">mmkin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"SFO-SFO"</span> <span class="op">=</span> <span class="va">m_sfo_sfo</span>,</span></span>
<span class="r-in"><span>   <span class="st">"SFO-SFO-ff"</span> <span class="op">=</span> <span class="va">m_sfo_sfo_ff</span>,</span></span>
<span class="r-in"><span>   <span class="st">"DFOP-SFO"</span> <span class="op">=</span> <span class="va">m_dfop_sfo</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="va">ds_2</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">f_nlme_sfo_sfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/nlme.html" class="external-link">nlme</a></span><span class="op">(</span><span class="va">f_2</span><span class="op">[</span><span class="st">"SFO-SFO"</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">f_nlme_sfo_sfo</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="nlme.mmkin-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># With formation fractions this does not coverge with defaults</span></span></span>
<span class="r-in"><span>  <span class="co"># f_nlme_sfo_sfo_ff &lt;- nlme(f_2["SFO-SFO-ff", ])</span></span></span>
<span class="r-in"><span>  <span class="co">#plot(f_nlme_sfo_sfo_ff)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># For the following, we need to increase pnlsMaxIter and the tolerance</span></span></span>
<span class="r-in"><span>  <span class="co"># to get convergence</span></span></span>
<span class="r-in"><span>  <span class="va">f_nlme_dfop_sfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/nlme.html" class="external-link">nlme</a></span><span class="op">(</span><span class="va">f_2</span><span class="op">[</span><span class="st">"DFOP-SFO"</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pnlsMaxIter <span class="op">=</span> <span class="fl">120</span>, tolerance <span class="op">=</span> <span class="fl">5e-4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">f_nlme_dfop_sfo</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="nlme.mmkin-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">f_nlme_dfop_sfo</span>, <span class="va">f_nlme_sfo_sfo</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 Model df       AIC      BIC    logLik   Test  L.Ratio p-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_nlme_dfop_sfo     1 13  843.8547  884.620 -408.9273                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_nlme_sfo_sfo      2  9 1085.1821 1113.404 -533.5910 1 vs 2 249.3274  &lt;.0001</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="endpoints.html">endpoints</a></span><span class="op">(</span><span class="va">f_nlme_sfo_sfo</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ff</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> parent_sink   parent_A1     A1_sink </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.5912432   0.4087568   1.0000000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $distimes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            DT50     DT90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> parent 19.13518  63.5657</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A1     66.02155 219.3189</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span>  <span class="fu"><a href="endpoints.html">endpoints</a></span><span class="op">(</span><span class="va">f_nlme_dfop_sfo</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ff</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   parent_A1 parent_sink </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.2768574   0.7231426 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $distimes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             DT50     DT90 DT50back  DT50_k1  DT50_k2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> parent  11.07091 104.6320 31.49737 4.462383 46.20825</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A1     162.30550 539.1672       NA       NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">findFunction</span><span class="op">(</span><span class="st">"varConstProp"</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span> <span class="co"># tc error model for nlme available</span></span></span>
<span class="r-in"><span>    <span class="co"># Attempts to fit metabolite kinetics with the tc error model are possible,</span></span></span>
<span class="r-in"><span>    <span class="co"># but need tweeking of control values and sometimes do not converge</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="va">f_tc</span> <span class="op">&lt;-</span> <span class="fu"><a href="mmkin.html">mmkin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SFO"</span>, <span class="st">"DFOP"</span><span class="op">)</span>, <span class="va">ds</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>, error_model <span class="op">=</span> <span class="st">"tc"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">f_nlme_sfo_tc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/nlme.html" class="external-link">nlme</a></span><span class="op">(</span><span class="va">f_tc</span><span class="op">[</span><span class="st">"SFO"</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">f_nlme_dfop_tc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/nlme.html" class="external-link">nlme</a></span><span class="op">(</span><span class="va">f_tc</span><span class="op">[</span><span class="st">"DFOP"</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">f_nlme_sfo</span>, <span class="va">f_nlme_sfo_tc</span>, <span class="va">f_nlme_dfop</span>, <span class="va">f_nlme_dfop_tc</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">f_nlme_dfop_tc</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kinetic nonlinear mixed-effects model fit by maximum likelihood</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Structural model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d_parent/dt = - ((k1 * g * exp(-k1 * time) + k2 * (1 - g) * exp(-k2 *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            time)) / (g * exp(-k1 * time) + (1 - g) * exp(-k2 * time)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            * parent</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 90 observations of 1 variable(s) grouped in 5 datasets</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: -238.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  list(parent_0 ~ 1, log_k1 ~ 1, log_k2 ~ 1, g_qlogis ~ 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> parent_0   log_k1   log_k2 g_qlogis </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 94.04774 -1.82340 -4.16716  0.05685 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Formula: list(parent_0 ~ 1, log_k1 ~ 1, log_k2 ~ 1, g_qlogis ~ 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Level: ds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Structure: Diagonal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         parent_0 log_k1 log_k2 g_qlogis Residual</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev:    2.474   0.85  1.337   0.4659        1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Variance function:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Structure: Constant plus proportion of variance covariate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Formula: ~fitted(.) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Parameter estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      const       prop </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2.23222933 0.01262399 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">f_2_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">f_2</span>, error_model <span class="op">=</span> <span class="st">"obs"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">f_nlme_sfo_sfo_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/nlme.html" class="external-link">nlme</a></span><span class="op">(</span><span class="va">f_2_obs</span><span class="op">[</span><span class="st">"SFO-SFO"</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">f_nlme_sfo_sfo_obs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Kinetic nonlinear mixed-effects model fit by maximum likelihood</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Structural model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d_parent/dt = - k_parent_sink * parent - k_parent_A1 * parent</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d_A1/dt = + k_parent_A1 * parent - k_A1_sink * A1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 170 observations of 2 variable(s) grouped in 5 datasets</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Log-likelihood: -473</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  list(parent_0 ~ 1, log_k_parent_sink ~ 1, log_k_parent_A1 ~ 1,      log_k_A1_sink ~ 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          parent_0 log_k_parent_sink   log_k_parent_A1     log_k_A1_sink </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            87.976            -3.670            -4.164            -4.645 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Formula: list(parent_0 ~ 1, log_k_parent_sink ~ 1, log_k_parent_A1 ~ 1,      log_k_A1_sink ~ 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Level: ds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Structure: Diagonal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         parent_0 log_k_parent_sink log_k_parent_A1 log_k_A1_sink Residual</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> StdDev:    3.992             1.777           1.055        0.4821    6.483</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Variance function:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Structure: Different standard deviations per stratum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Formula: ~1 | name </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Parameter estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    parent        A1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.0000000 0.2050005 </span>
<span class="r-in"><span>  <span class="va">f_nlme_dfop_sfo_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/nlme.html" class="external-link">nlme</a></span><span class="op">(</span><span class="va">f_2_obs</span><span class="op">[</span><span class="st">"DFOP-SFO"</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pnlsMaxIter <span class="op">=</span> <span class="fl">120</span>, tolerance <span class="op">=</span> <span class="fl">5e-4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">f_2_tc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">f_2</span>, error_model <span class="op">=</span> <span class="st">"tc"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># f_nlme_sfo_sfo_tc &lt;- nlme(f_2_tc["SFO-SFO", ]) # No convergence with 50 iterations</span></span></span>
<span class="r-in"><span>  <span class="co"># f_nlme_dfop_sfo_tc &lt;- nlme(f_2_tc["DFOP-SFO", ],</span></span></span>
<span class="r-in"><span>  <span class="co">#  control = list(pnlsMaxIter = 120, tolerance = 5e-4)) # Error in X[, fmap[[nm]]] &lt;- gradnm</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">f_nlme_dfop_sfo</span>, <span class="va">f_nlme_dfop_sfo_obs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     Model df      AIC     BIC    logLik   Test  L.Ratio p-value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_nlme_dfop_sfo         1 13 843.8547 884.620 -408.9273                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f_nlme_dfop_sfo_obs     2 14 817.5338 861.435 -394.7669 1 vs 2 28.32084  &lt;.0001</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johannes Ranke.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

